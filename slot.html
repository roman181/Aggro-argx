<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <title>ARGO‚ÄëHYTOS Novo Slot</title>
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Arial, sans-serif;
    }

    body {
      background: radial-gradient(ellipse at top, #1a1a2e, #16213e, #0f3460);
      color: #fff;
      display: flex;
      justify-content: center;
      align-items: center;
      min-height: 100vh;
      padding: 20px;
    }

    .slot-container {
      background: linear-gradient(145deg, #222831, #393e46);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 
        0 20px 50px rgba(0, 0, 0, 0.8),
        0 0 0 1px #333,
        0 0 30px rgba(244, 211, 94, 0.3);
      width: 900px;
      max-width: 95vw;
      border: 3px solid #f4d35e;
      position: relative;
      overflow: hidden;
    }

    .slot-container::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 5px;
      background: linear-gradient(90deg, #f4d35e, #ff9800, #f4d35e);
      animation: shimmer 3s infinite linear;
    }

    @keyframes shimmer {
      0% { background-position: -200px 0; }
      100% { background-position: 200px 0; }
    }

    .slot-header {
      text-align: center;
      margin-bottom: 20px;
      position: relative;
    }

    .slot-header h1 {
      font-size: 32px;
      letter-spacing: 4px;
      text-transform: uppercase;
      background: linear-gradient(45deg, #f4d35e, #ffd700, #ff9800);
      -webkit-background-clip: text;
      background-clip: text;
      color: transparent;
      text-shadow: 0 0 15px rgba(244, 211, 94, 0.5);
      margin-bottom: 10px;
      font-weight: 900;
    }

    .slot-header span {
      font-size: 14px;
      color: #aaa;
      letter-spacing: 1px;
    }

    .jackpot-display {
      background: linear-gradient(45deg, #d4af37, #ffd700);
      color: #000;
      padding: 8px 20px;
      border-radius: 30px;
      display: inline-block;
      margin-top: 10px;
      font-weight: bold;
      font-size: 18px;
      animation: pulse-gold 2s infinite;
      box-shadow: 0 0 20px rgba(212, 175, 55, 0.5);
    }

    .free-spins-display {
      background: linear-gradient(45deg, #4CAF50, #8BC34A);
      color: white;
      padding: 8px 20px;
      border-radius: 30px;
      display: inline-block;
      margin-top: 10px;
      font-weight: bold;
      font-size: 18px;
      animation: pulse-green 2s infinite;
      box-shadow: 0 0 20px rgba(76, 175, 80, 0.5);
      margin-left: 10px;
    }

    @keyframes pulse-gold {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    @keyframes pulse-green {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }

    .display-panel {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 15px;
      margin-bottom: 20px;
    }

    @media (max-width: 768px) {
      .display-panel {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .display-item {
      background: rgba(0, 0, 0, 0.5);
      border-radius: 15px;
      padding: 15px;
      border: 2px solid #333;
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }

    .display-item:hover {
      border-color: #f4d35e;
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(0,0,0,0.3);
    }

    .display-item::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.1), transparent);
      transition: left 0.5s ease;
    }

    .display-item:hover::before {
      left: 100%;
    }

    .display-label {
      font-size: 12px;
      color: #aaa;
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-bottom: 5px;
    }

    .display-value {
      font-size: 28px;
      font-weight: bold;
      color: #5cf25c;
      text-shadow: 0 0 10px rgba(92, 242, 92, 0.5);
    }

    .win-display {
      color: #ffd700 !important;
      text-shadow: 0 0 15px rgba(255, 215, 0, 0.7) !important;
    }

    .free-spins-value {
      color: #8BC34A !important;
      text-shadow: 0 0 10px rgba(139, 195, 74, 0.5) !important;
    }

    .reels-wrapper {
      background: radial-gradient(circle at center, #2d4059, #222831);
      border-radius: 15px;
      padding: 20px;
      border: 3px solid #444;
      margin-bottom: 20px;
      position: relative;
      overflow: hidden;
    }

    .reels-wrapper::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.03) 50%, transparent 70%);
      animation: shine 3s infinite linear;
    }

    @keyframes shine {
      0% { transform: translateX(-100%); }
      100% { transform: translateX(100%); }
    }

    .reels {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      grid-template-rows: repeat(3, 110px);
      gap: 8px;
    }

    .symbol-cell {
      background: linear-gradient(145deg, #1a1a2e, #16213e);
      border-radius: 10px;
      border: 2px solid #333;
      display: flex;
      justify-content: center;
      align-items: center;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      overflow: hidden;
      position: relative;
    }

    .symbol-cell::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(45deg, transparent 30%, rgba(255,255,255,0.05) 50%, transparent 70%);
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .symbol-cell:hover::after {
      opacity: 1;
    }

    .symbol-img {
      width: 90%;
      height: 90%;
      object-fit: contain;
      border-radius: 6px;
      background: rgba(255,255,255,0.95);
      padding: 5px;
      transition: transform 0.3s ease;
    }

    .symbol-cell:hover .symbol-img {
      transform: scale(1.1);
    }

    .symbol-win {
      animation: win-pulse 0.5s ease-in-out 3;
      border-color: #ffd700 !important;
      box-shadow: 
        0 0 20px #ffd700,
        inset 0 0 20px rgba(255, 215, 0, 0.3);
    }

    .scatter-symbol {
      animation: scatter-pulse 2s infinite;
      border-color: #4CAF50 !important;
      box-shadow: 
        0 0 20px #4CAF50,
        inset 0 0 20px rgba(76, 175, 80, 0.3);
    }

    @keyframes win-pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.1); }
    }

    @keyframes scatter-pulse {
      0%, 100% { 
        transform: scale(1);
        box-shadow: 0 0 20px #4CAF50, inset 0 0 20px rgba(76, 175, 80, 0.3);
      }
      50% { 
        transform: scale(1.15);
        box-shadow: 0 0 30px #4CAF50, inset 0 0 30px rgba(76, 175, 80, 0.5);
      }
    }

    .win-line {
      position: absolute;
      width: 100%;
      height: 110px;
      top: 20px;
      left: 0;
      background: linear-gradient(90deg, 
        transparent 0%, 
        rgba(0, 255, 0, 0.2) 10%, 
        rgba(0, 255, 0, 0.4) 50%, 
        rgba(0, 255, 0, 0.2) 90%, 
        transparent 100%);
      opacity: 0;
      pointer-events: none;
      z-index: 5;
    }

    .controls {
      display: grid;
      grid-template-columns: 1fr auto 1fr;
      gap: 20px;
      align-items: center;
      margin-bottom: 15px;
    }

    .control-group {
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .center-controls {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 10px;
    }

    .lines-control {
      background: rgba(0, 0, 0, 0.7);
      border-radius: 20px;
      padding: 10px 20px;
      border: 2px solid #4CAF50;
      font-size: 16px;
      font-weight: bold;
      color: #4CAF50;
      min-width: 150px;
      text-align: center;
      margin-right: 10px;
    }

    button {
      background: linear-gradient(180deg, #2e7d32, #1b5e20);
      color: #fff;
      border: none;
      border-radius: 25px;
      padding: 12px 24px;
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      text-transform: uppercase;
      letter-spacing: 1.5px;
      min-width: 100px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
    }

    button::before {
      content: '';
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg, transparent, rgba(255,255,255,0.2), transparent);
      transition: left 0.5s ease;
    }

    button:hover::before {
      left: 100%;
    }

    button:hover {
      transform: translateY(-3px);
      box-shadow: 0 10px 20px rgba(102, 187, 106, 0.4);
      background: linear-gradient(180deg, #3fa543, #2e7d32);
    }

    button:active {
      transform: translateY(0);
      box-shadow: 0 3px 10px rgba(0,0,0,0.2);
    }

    button:disabled {
      background: #444;
      color: #666;
      cursor: not-allowed;
      transform: none;
      box-shadow: none;
    }

    button:disabled:hover::before {
      left: -100%;
    }

    #spin-button {
      background: linear-gradient(180deg, #d32f2f, #b71c1c);
      font-size: 18px;
      padding: 18px 40px;
      min-width: 150px;
      box-shadow: 0 0 30px rgba(211, 47, 47, 0.5);
    }

    #spin-button:hover {
      background: linear-gradient(180deg, #f44336, #d32f2f);
      box-shadow: 0 0 40px rgba(244, 67, 54, 0.6);
    }

    .bet-display {
      background: rgba(0, 0, 0, 0.7);
      border-radius: 20px;
      padding: 10px 20px;
      border: 2px solid #f4d35e;
      font-size: 16px;
      font-weight: bold;
      color: #f4d35e;
      min-width: 150px;
      text-align: center;
    }

    .messages {
      margin-top: 15px;
      min-height: 40px;
      padding: 10px;
      background: rgba(0,0,0,0.5);
      border-radius: 10px;
      border: 1px solid #333;
      font-size: 14px;
      color: #f4d35e;
      text-align: center;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all 0.3s ease;
    }

    .win-message {
      background: rgba(92, 242, 92, 0.1);
      border-color: #5cf25c;
      color: #5cf25c;
      animation: message-pulse 1s infinite;
    }

    .free-spins-message {
      background: rgba(76, 175, 80, 0.1);
      border-color: #4CAF50;
      color: #4CAF50;
      animation: message-pulse 1s infinite;
    }

    @keyframes message-pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.7; }
    }

    .stats-panel {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 10px;
      margin-top: 20px;
    }

    @media (max-width: 768px) {
      .stats-panel {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .stat-item {
      background: rgba(0,0,0,0.3);
      padding: 10px;
      border-radius: 10px;
      text-align: center;
      border: 1px solid #333;
      transition: all 0.3s ease;
    }

    .stat-item:hover {
      border-color: #f4d35e;
      transform: translateY(-2px);
    }

    .stat-label {
      font-size: 11px;
      color: #aaa;
      text-transform: uppercase;
      margin-bottom: 5px;
    }

    .stat-value {
      font-size: 18px;
      font-weight: bold;
      color: #fff;
    }

    .paytable {
      margin-top: 20px;
      padding-top: 15px;
      border-top: 2px solid #333;
    }

    .paytable-title {
      color: #f4d35e;
      font-weight: bold;
      margin-bottom: 10px;
      font-size: 16px;
      text-align: center;
    }

    .paytable-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 10px;
    }

    .paytable-item {
      background: rgba(0,0,0,0.3);
      padding: 8px;
      border-radius: 8px;
      font-size: 12px;
      color: #ccc;
      border-left: 3px solid #f4d35e;
    }

    .scatter-item {
      border-left: 3px solid #4CAF50;
      background: rgba(76, 175, 80, 0.1);
    }

    @media (max-width: 768px) {
      .slot-container {
        padding: 15px;
      }
      
      .display-panel {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .reels {
        grid-template-rows: repeat(3, 80px);
      }
      
      .controls {
        grid-template-columns: 1fr;
        gap: 10px;
      }
      
      .center-controls {
        order: -1;
      }
      
      .stats-panel {
        grid-template-columns: repeat(2, 1fr);
      }
      
      button {
        padding: 10px 15px;
        font-size: 13px;
        min-width: 80px;
      }
      
      #spin-button {
        padding: 15px 30px;
        font-size: 16px;
      }
    }

    /* Sound Control */
    .sound-control {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 10;
    }

    .sound-btn {
      background: rgba(0,0,0,0.5);
      width: 40px;
      height: 40px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      border: 2px solid #f4d35e;
      color: #f4d35e;
      font-size: 18px;
      transition: all 0.3s ease;
    }

    .sound-btn:hover {
      transform: scale(1.1);
      box-shadow: 0 0 15px rgba(244, 211, 94, 0.5);
    }
  </style>
</head>
<body>
  <div class="slot-container">
    <!-- Sound Control -->
    <div class="sound-control">
      <div class="sound-btn" id="soundToggle" onclick="toggleSound()">
        <i class="fas fa-volume-up"></i>
      </div>
    </div>

    <div class="slot-header">
      <h1>ARGO‚ÄëHYTOS NOVO SLOT</h1>
      <span>5 Walzen ‚Ä¢ 3 Reihen ‚Ä¢ 3-15 Gewinnlinien ‚Ä¢ Freispiele</span>
      <div class="jackpot-display">
        <i class="fas fa-trophy"></i> Jackpot: 50.000 Credits
      </div>
      <div class="free-spins-display" id="freeSpinsDisplay" style="display: none;">
        <i class="fas fa-plane"></i> Urlaub: <span id="freeSpinsCount">0</span> Freispiele
      </div>
    </div>

    <div class="display-panel">
      <div class="display-item">
        <div class="display-label">Guthaben</div>
        <div class="display-value" id="balance-display">1.000</div>
      </div>
      <div class="display-item">
        <div class="display-label">Einsatz</div>
        <div class="display-value" id="bet-display">10</div>
      </div>
      <div class="display-item">
        <div class="display-label">Gewinn</div>
        <div class="display-value win-display" id="win-display">0</div>
      </div>
      <div class="display-item">
        <div class="display-label">Gewinnlinien</div>
        <div class="display-value free-spins-value" id="lines-display">15</div>
      </div>
    </div>

    <div class="reels-wrapper">
      <div class="win-line" id="winLine"></div>
      <div class="reels" id="reels"></div>
    </div>

    <div class="controls">
      <div class="control-group">
        <button id="lines-minus">-</button>
        <div class="lines-control">Linien: <span id="current-lines">15</span></div>
        <button id="lines-plus">+</button>
      </div>

      <div class="center-controls">
        <button id="spin-button">
          <i class="fas fa-play"></i> SPIN
        </button>
        <button id="auto-button">
          <i class="fas fa-sync-alt"></i> AUTO
        </button>
      </div>

      <div class="control-group" style="justify-content: flex-end;">
        <button id="bet-minus">-</button>
        <div class="bet-display">Einsatz: <span id="current-bet">10</span></div>
        <button id="bet-plus">+</button>
        <button id="max-bet">MAX</button>
      </div>
    </div>

    <div class="messages" id="message">
      Willkommen! Dr√ºcke SPIN um zu beginnen.
    </div>

    <div class="stats-panel">
      <div class="stat-item">
        <div class="stat-label">Heutige Spins</div>
        <div class="stat-value" id="daily-spins">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Heutiger Gewinn</div>
        <div class="stat-value" id="daily-win">0</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Gewinnrate</div>
        <div class="stat-value" id="win-rate">0%</div>
      </div>
      <div class="stat-item">
        <div class="stat-label">Bestes Ergebnis</div>
        <div class="stat-value" id="best-win">0</div>
      </div>
    </div>

    <div class="paytable">
      <div class="paytable-title">GEWINNTABELLE (pro Linie)</div>
      <div class="paytable-grid">
        <div class="paytable-item">YOUTUBE_LOGO: 3=10√ó, 4=50√ó, 5=300√ó</div>
        <div class="paytable-item">ARGO_VOITH_LOGO: 3=8√ó, 4=40√ó, 5=220√ó</div>
        <div class="paytable-item">FILTERDECKEL: 3=6√ó, 4=30√ó, 5=150√ó</div>
        <div class="paytable-item">SO0426: 3=5√ó, 4=20√ó, 5=100√ó</div>
        <div class="paytable-item">AS080: 3=4√ó, 4=15√ó, 5=80√ó</div>
        <div class="paytable-item">MFE: 3=3√ó, 4=12√ó, 5=60√ó</div>
        <div class="paytable-item scatter-item">
          <strong>SCATTER (Urlaub):</strong><br>
          3+ SCATTER = 10 Freispiele<br>
          W√§hrend Freispielen: 3x Multiplikator
        </div>
      </div>
    </div>
  </div>

  <!-- Font Awesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

  <script>
    // ============================================
    // ARGO SLOT - ERWEITERTE VERSION MIT LINIEN & FREISPRECHEN
    // ============================================

    // Konfiguration
    const CONFIG = {
      symbols: [
        {
          id: "YOUTUBE_LOGO",
          name: "YouTube Logo",
          weight: 3,
          multiplier: {3: 10, 4: 50, 5: 300},
          url: "https://yt3.googleusercontent.com/ytc/AIdro_k2ME-LZeXI9Ab6PpYdMRpCLZx2JFoBHHWqRiSiJWeivD0=s160-c-k-c0x00ffffff-no-rj",
          color: "#FF0000"
        },
        {
          id: "ARGO_VOITH_LOGO",
          name: "ARGO Voith Logo",
          weight: 3,
          multiplier: {3: 8, 4: 40, 5: 220},
          url: "https://www.argo-hytos.com/typo3temp/_processed_/csm_Argo-Hytos_Voith_Logo_RGB_01_87252b57cb.png",
          color: "#003366"
        },
        {
          id: "FILTERDECKEL",
          name: "Filterdeckel",
          weight: 4,
          multiplier: {3: 6, 4: 30, 5: 150},
          url: "https://hydraulik-store.de/wp-content/uploads/2022/06/Belueftungsfilterdeckel.jpg",
          color: "#666666"
        },
        {
          id: "SO0426",
          name: "SO0426 Produkt",
          weight: 4,
          multiplier: {3: 5, 4: 20, 5: 100},
          url: "https://www.argo-hytos.com/fileadmin/user_upload/categories/SO0426_150dpi.jpg",
          color: "#0066CC"
        },
        {
          id: "AS080",
          name: "AS080 Baureihe",
          weight: 5,
          multiplier: {3: 4, 4: 15, 5: 80},
          url: "https://www.argo-hytos.com/fileadmin/user_upload/categories/AS080_150dpi.jpg",
          color: "#009933"
        },
        {
          id: "MFE",
          name: "MFE Filter",
          weight: 6,
          multiplier: {3: 3, 4: 12, 5: 60},
          url: "https://www.argo-hytos.com/fileadmin/user_upload/categories/MFE_150dpi_01.jpg",
          color: "#CC3300"
        },
        {
          id: "SCATTER",
          name: "Scatter (Urlaub)",
          weight: 2,
          isScatter: true,
          url: "https://cdn-icons-png.flaticon.com/512/546/546272.png",
          color: "#4CAF50",
          freeSpins: 10
        }
      ],
      
      // 15 m√∂gliche Gewinnlinien
      paylines: [
        [0,0,0,0,0], // Linie 1: Mittlere Reihe
        [1,1,1,1,1], // Linie 2: Obere Reihe
        [2,2,2,2,2], // Linie 3: Untere Reihe
        [0,1,2,1,0], // Linie 4: V-Form
        [2,1,0,1,2], // Linie 5: A-Form
        [0,0,1,2,2], // Linie 6: Diagonale
        [2,2,1,0,0], // Linie 7: Diagonale
        [1,0,0,0,1], // Linie 8
        [1,2,2,2,1], // Linie 9
        [0,2,0,2,0], // Linie 10: Zick-Zack
        [2,0,2,0,2], // Linie 11: Zick-Zack
        [1,0,1,2,1], // Linie 12
        [1,2,1,0,1], // Linie 13
        [0,1,0,1,0], // Linie 14
        [2,1,2,1,2]  // Linie 15
      ],
      
      betSteps: [1, 5, 10, 25, 50, 100, 250, 500],
      maxBet: 500,
      minLines: 3,
      maxLines: 15,
      
      stats: {
        dailySpins: 0,
        dailyWins: 0,
        totalSpins: 0,
        totalWins: 0,
        biggestWin: 0,
        winStreak: 0,
        bestStreak: 0,
        freeSpinsTriggered: 0,
        freeSpinsWon: 0
      }
    };

    // State Management
    let State = {
      balance: 1000,
      currentBet: 10,
      currentLines: 15,
      isSpinning: false,
      autoPlay: false,
      autoSpinsRemaining: 0,
      soundEnabled: true,
      spinHistory: [],
      jackpot: 50000,
      winLines: [],
      freeSpins: 0,
      isFreeSpin: false,
      freeSpinMultiplier: 1
    };

    // DOM Elemente
    let elements = {};

    // Initialisierung
    function init() {
      // DOM Elemente zuweisen
      elements = {
        reels: document.getElementById('reels'),
        balanceDisplay: document.getElementById('balance-display'),
        betDisplay: document.getElementById('bet-display'),
        winDisplay: document.getElementById('win-display'),
        message: document.getElementById('message'),
        spinButton: document.getElementById('spin-button'),
        autoButton: document.getElementById('auto-button'),
        betMinus: document.getElementById('bet-minus'),
        betPlus: document.getElementById('bet-plus'),
        linesMinus: document.getElementById('lines-minus'),
        linesPlus: document.getElementById('lines-plus'),
        maxBet: document.getElementById('max-bet'),
        winLine: document.getElementById('win-line'),
        dailySpins: document.getElementById('daily-spins'),
        dailyWin: document.getElementById('daily-win'),
        winRate: document.getElementById('win-rate'),
        bestWin: document.getElementById('best-win'),
        currentBet: document.getElementById('current-bet'),
        currentLines: document.getElementById('current-lines'),
        linesDisplay: document.getElementById('lines-display'),
        freeSpinsDisplay: document.getElementById('freeSpinsDisplay'),
        freeSpinsCount: document.getElementById('freeSpinsCount')
      };
      
      createReelGrid();
      updateUI();
      loadStats();
      setupEventListeners();
      
      // Startanimation
      setTimeout(() => {
        showMessage('Bereit zum Spielen! Viel Gl√ºck!', 'info');
      }, 1000);
    }

    // Erstelle das Raster
    function createReelGrid() {
      const ROWS = 3;
      const COLS = 5;
      
      elements.reels.innerHTML = '';
      
      for (let row = 0; row < ROWS; row++) {
        for (let col = 0; col < COLS; col++) {
          const cell = document.createElement('div');
          cell.className = 'symbol-cell';
          cell.dataset.row = row;
          cell.dataset.col = col;
          cell.dataset.symbol = '';
          
          const symbol = getRandomSymbol();
          cell.innerHTML = `
            <img src="${symbol.url}" alt="${symbol.id}" class="symbol-img">
          `;
          cell.dataset.symbol = symbol.id;
          if (symbol.isScatter) {
            cell.classList.add('scatter-symbol');
          }
          
          elements.reels.appendChild(cell);
        }
      }
    }

    // Zuf√§lliges Symbol basierend auf Gewichtung
    function getRandomSymbol() {
      const totalWeight = CONFIG.symbols.reduce((sum, s) => sum + s.weight, 0);
      let random = Math.random() * totalWeight;
      
      for (const symbol of CONFIG.symbols) {
        if (random < symbol.weight) return symbol;
        random -= symbol.weight;
      }
      
      return CONFIG.symbols[0];
    }

    // UI aktualisieren
    function updateUI() {
      elements.balanceDisplay.textContent = State.balance.toLocaleString('de-DE');
      elements.betDisplay.textContent = State.currentBet.toLocaleString('de-DE');
      elements.currentBet.textContent = State.currentBet.toLocaleString('de-DE');
      elements.currentLines.textContent = State.currentLines;
      elements.linesDisplay.textContent = State.currentLines;
      
      // Freispiele anzeigen
      if (State.freeSpins > 0) {
        elements.freeSpinsDisplay.style.display = 'inline-block';
        elements.freeSpinsCount.textContent = State.freeSpins;
      } else {
        elements.freeSpinsDisplay.style.display = 'none';
      }
      
      // Stats aktualisieren
      elements.dailySpins.textContent = CONFIG.stats.dailySpins;
      elements.dailyWin.textContent = CONFIG.stats.dailyWins.toLocaleString('de-DE');
      
      const rate = CONFIG.stats.totalSpins > 0 
        ? ((CONFIG.stats.totalWins / CONFIG.stats.totalSpins) * 100).toFixed(1)
        : '0';
      elements.winRate.textContent = `${rate}%`;
      
      elements.bestWin.textContent = CONFIG.stats.biggestWin.toLocaleString('de-DE');
      
      // Buttons aktivieren/deaktivieren
      elements.spinButton.disabled = State.isSpinning;
      elements.betMinus.disabled = State.isSpinning || State.currentBet <= 1;
      elements.betPlus.disabled = State.isSpinning || State.currentBet >= CONFIG.maxBet;
      elements.linesMinus.disabled = State.isSpinning || State.currentLines <= CONFIG.minLines;
      elements.linesPlus.disabled = State.isSpinning || State.currentLines >= CONFIG.maxLines;
      elements.maxBet.disabled = State.isSpinning;
      elements.autoButton.disabled = State.isSpinning;
      
      // Auto-Button Text
      if (State.autoPlay) {
        elements.autoButton.innerHTML = `<i class="fas fa-stop"></i> AUTO (${State.autoSpinsRemaining})`;
      } else {
        elements.autoButton.innerHTML = '<i class="fas fa-sync-alt"></i> AUTO';
      }
    }

    // Statistiken laden
    function loadStats() {
      try {
        const saved = localStorage.getItem('argoSlotStats');
        if (saved) {
          const data = JSON.parse(saved);
          CONFIG.stats = { ...CONFIG.stats, ...data };
        }
      } catch (e) {
        console.log('Keine gespeicherten Stats gefunden');
      }
    }

    // Statistiken speichern
    function saveStats() {
      localStorage.setItem('argoSlotStats', JSON.stringify(CONFIG.stats));
    }

    // Event Listener
    function setupEventListeners() {
      elements.spinButton.addEventListener('click', startSpin);
      elements.autoButton.addEventListener('click', toggleAutoPlay);
      elements.betMinus.addEventListener('click', decreaseBet);
      elements.betPlus.addEventListener('click', increaseBet);
      elements.linesMinus.addEventListener('click', decreaseLines);
      elements.linesPlus.addEventListener('click', increaseLines);
      elements.maxBet.addEventListener('click', setMaxBet);
      
      // Tastatur-Shortcuts
      document.addEventListener('keydown', (e) => {
        if (e.code === 'Space' && !State.isSpinning) {
          e.preventDefault();
          startSpin();
        }
        
        if (e.code === 'ArrowUp') increaseBet();
        if (e.code === 'ArrowDown') decreaseBet();
        if (e.code === 'KeyA') toggleAutoPlay();
        if (e.code === 'KeyM') setMaxBet();
        if (e.code === 'ArrowLeft') decreaseLines();
        if (e.code === 'ArrowRight') increaseLines();
      });
    }

    // Einsatz erh√∂hen
    function increaseBet() {
      if (State.isSpinning) return;
      
      const currentIndex = CONFIG.betSteps.indexOf(State.currentBet);
      if (currentIndex < CONFIG.betSteps.length - 1) {
        State.currentBet = CONFIG.betSteps[currentIndex + 1];
        updateUI();
        playSound('chip');
      }
    }

    // Einsatz verringern
    function decreaseBet() {
      if (State.isSpinning) return;
      
      const currentIndex = CONFIG.betSteps.indexOf(State.currentBet);
      if (currentIndex > 0) {
        State.currentBet = CONFIG.betSteps[currentIndex - 1];
        updateUI();
        playSound('chip');
      }
    }

    // Linien erh√∂hen
    function increaseLines() {
      if (State.isSpinning) return;
      
      if (State.currentLines < CONFIG.maxLines) {
        State.currentLines++;
        updateUI();
        playSound('chip');
      }
    }

    // Linien verringern
    function decreaseLines() {
      if (State.isSpinning) return;
      
      if (State.currentLines > CONFIG.minLines) {
        State.currentLines--;
        updateUI();
        playSound('chip');
      }
    }

    // Maximaler Einsatz
    function setMaxBet() {
      if (State.isSpinning) return;
      
      State.currentBet = CONFIG.maxBet;
      State.currentLines = CONFIG.maxLines;
      updateUI();
      playSound('chip');
    }

    // Auto-Play umschalten
    function toggleAutoPlay() {
      if (State.isSpinning) return;
      
      State.autoPlay = !State.autoPlay;
      
      if (State.autoPlay) {
        State.autoSpinsRemaining = 10;
        showMessage('Auto-Play aktiviert (10 Spins)', 'info');
        // Starte den ersten Spin
        setTimeout(() => startSpin(), 500);
      } else {
        showMessage('Auto-Play deaktiviert', 'info');
      }
      
      updateUI();
    }

    // Spin starten - HAUPTPROBLEM BEHOBEN
    function startSpin() {
      if (State.isSpinning) return;
      
      // Berechne Gesamteinsatz
      const totalBet = State.currentBet * State.currentLines;
      
      // Guthaben pr√ºfen (au√üer bei Freispielen)
      if (State.balance < totalBet && !State.isFreeSpin) {
        showMessage('Nicht genug Guthaben!', 'error');
        if (State.autoPlay) {
          State.autoPlay = false;
          State.autoSpinsRemaining = 0;
        }
        return;
      }
      
      // State auf Spinning setzen
      State.isSpinning = true;
      
      if (!State.isFreeSpin) {
        State.balance -= totalBet;
        CONFIG.stats.dailySpins++;
        CONFIG.stats.totalSpins++;
      } else {
        // Bei Freispielen kostenlos
        State.freeSpins--;
      }
      
      // Win-Highlights entfernen
      clearWinHighlights();
      
      // Nachricht anzeigen
      if (State.isFreeSpin) {
        showMessage(`Urlaub Freispiel! Noch ${State.freeSpins + 1} √ºbrig (${State.freeSpinMultiplier}x)`, 'free-spins');
      } else {
        showMessage('Walzen drehen...', 'info');
      }
      
      elements.winDisplay.textContent = '0';
      
      // UI aktualisieren (Buttons deaktivieren)
      updateUI();
      
      // Animation starten
      animateSpin().then(() => {
        // Nach Animation: Gewinn berechnen
        processSpinResult();
      }).catch(error => {
        console.error('Spin Animation Error:', error);
        State.isSpinning = false;
        updateUI();
        showMessage('Fehler bei der Animation', 'error');
      });
    }

    // Spin-Animation
    function animateSpin() {
      return new Promise((resolve) => {
        const cells = Array.from(elements.reels.querySelectorAll('.symbol-cell'));
        const duration = 800; // K√ºrzere Animation
        const startTime = performance.now();
        let animationFrame;
        
        function animate(currentTime) {
          const elapsed = currentTime - startTime;
          const progress = Math.min(elapsed / duration, 1);
          
          // Schnelle Symbolwechsel w√§hrend der Animation
          if (progress < 0.7) {
            cells.forEach(cell => {
              if (Math.random() < 0.4) {
                const symbol = getRandomSymbol();
                const img = cell.querySelector('img');
                if (img) {
                  img.src = symbol.url;
                  img.alt = symbol.id;
                }
                cell.dataset.symbol = symbol.id;
                cell.classList.remove('scatter-symbol');
                if (symbol.isScatter) {
                  cell.classList.add('scatter-symbol');
                }
              }
            });
          }
          
          if (progress < 1) {
            animationFrame = requestAnimationFrame(animate);
          } else {
            // Endg√ºltige Symbole setzen
            cells.forEach(cell => {
              const symbol = getRandomSymbol();
              const img = cell.querySelector('img');
              if (img) {
                img.src = symbol.url;
                img.alt = symbol.id;
              }
              cell.dataset.symbol = symbol.id;
              cell.classList.remove('scatter-symbol');
              if (symbol.isScatter) {
                cell.classList.add('scatter-symbol');
              }
            });
            
            cancelAnimationFrame(animationFrame);
            resolve();
          }
        }
        
        animationFrame = requestAnimationFrame(animate);
        
        // Sicherheits-Timeout
        setTimeout(() => {
          cancelAnimationFrame(animationFrame);
          resolve();
        }, duration + 500);
      });
    }

    // Gewinn berechnen und verarbeiten
    function processSpinResult() {
      try {
        // Gewinn berechnen
        const winResult = calculateWin();
        const winAmount = winResult.amount;
        
        // Pr√ºfe auf Scatter f√ºr Freispiele
        const scatterResult = checkScatter();
        let freeSpinsWon = 0;
        
        if (scatterResult.scatterCount >= 3) {
          freeSpinsWon = CONFIG.symbols.find(s => s.id === "SCATTER").freeSpins;
          State.freeSpins += freeSpinsWon;
          CONFIG.stats.freeSpinsTriggered++;
          CONFIG.stats.freeSpinsWon += freeSpinsWon;
          
          if (!State.isFreeSpin) {
            State.isFreeSpin = true;
            State.freeSpinMultiplier = 3; // 3x Multiplikator w√§hrend Freispielen
          }
        }
        
        if (winAmount > 0) {
          // Gewinn mit Multiplikator berechnen
          const finalWinAmount = Math.floor(winAmount * State.freeSpinMultiplier);
          
          // Gewinn auszahlen
          State.balance += finalWinAmount;
          CONFIG.stats.dailyWins += finalWinAmount;
          CONFIG.stats.totalWins++;
          CONFIG.stats.winStreak++;
          
          if (finalWinAmount > CONFIG.stats.biggestWin) {
            CONFIG.stats.biggestWin = finalWinAmount;
          }
          
          if (CONFIG.stats.winStreak > CONFIG.stats.bestStreak) {
            CONFIG.stats.bestStreak = CONFIG.stats.winStreak;
          }
          
          // Gewinnanimation
          elements.winDisplay.textContent = finalWinAmount.toLocaleString('de-DE');
          highlightWinningSymbols(winResult.winningLines);
          
          let message = `GEWINN! ${finalWinAmount.toLocaleString('de-DE')} Credits`;
          if (State.freeSpinMultiplier > 1) {
            message += ` (${State.freeSpinMultiplier}x MULTIPLIKATOR)`;
          }
          
          if (freeSpinsWon > 0) {
            message += ` + ${freeSpinsWon} FREISPIELE!`;
            showMessage(`üéâ ${message}`, 'free-spins');
            playSound('free-spins');
          } else {
            showMessage(message, 'win');
            playSound('win');
          }
          
          // Bei gro√üen Gewinnen
          if (finalWinAmount >= (State.currentBet * State.currentLines) * 50) {
            playSound('big-win');
            showMessage(`üéâ MEGA GEWINN! ${finalWinAmount.toLocaleString('de-DE')} Credits!`, 'win');
          }
        } else if (freeSpinsWon > 0) {
          showMessage(`üéâ ${freeSpinsWon} FREISPIELE GEWONNEN!`, 'free-spins');
          playSound('free-spins');
        } else {
          CONFIG.stats.winStreak = 0;
          if (State.isFreeSpin) {
            showMessage(`Kein Gewinn. Noch ${State.freeSpins} Freispiele √ºbrig.`, 'free-spins');
          } else {
            showMessage('Kein Gewinn. Versuche es nochmal!', 'info');
          }
        }
        
        // Pr√ºfen ob Freispiele enden
        if (State.freeSpins === 0 && State.isFreeSpin) {
          State.isFreeSpin = false;
          State.freeSpinMultiplier = 1;
          showMessage('Freispiele beendet!', 'info');
        }
        
      } catch (error) {
        console.error('Error in processSpinResult:', error);
        showMessage('Fehler bei der Gewinnberechnung', 'error');
      } finally {
        // WICHTIG: State zur√ºcksetzen
        State.isSpinning = false;
        
        // Auto-Spin fortsetzen
        if (State.autoPlay && State.autoSpinsRemaining > 0) {
          State.autoSpinsRemaining--;
          
          // Pr√ºfe ob genug Guthaben f√ºr n√§chsten Spin
          const totalBet = State.currentBet * State.currentLines;
          if (State.balance >= totalBet || State.isFreeSpin) {
            setTimeout(() => startSpin(), 1500);
          } else {
            State.autoPlay = false;
            State.autoSpinsRemaining = 0;
            showMessage('Auto-Play beendet: Nicht genug Guthaben', 'info');
          }
        } else if (State.autoPlay && State.autoSpinsRemaining === 0) {
          State.autoPlay = false;
          showMessage('Auto-Play beendet', 'info');
        }
        
        // UI aktualisieren
        updateUI();
        saveStats();
      }
    }

    // Gewinn berechnen (nur f√ºr aktive Linien)
    function calculateWin() {
      const ROWS = 3;
      const COLS = 5;
      const grid = [];
      
      // Grid aus DOM lesen
      for (let row = 0; row < ROWS; row++) {
        grid[row] = [];
        for (let col = 0; col < COLS; col++) {
          const cell = elements.reels.querySelector(`[data-row="${row}"][data-col="${col}"]`);
          grid[row][col] = cell ? cell.dataset.symbol : "";
        }
      }
      
      let totalWin = 0;
      const winningLines = [];
      
      // Nur aktive Linien pr√ºfen (basierend auf State.currentLines)
      for (let lineIndex = 0; lineIndex < State.currentLines; lineIndex++) {
        const payline = CONFIG.paylines[lineIndex];
        const lineSymbols = [];
        
        // Symbole entlang der Gewinnlinie sammeln
        for (let col = 0; col < COLS; col++) {
          const row = payline[col];
          lineSymbols.push(grid[row][col]);
        }
        
        // √úberspringe Scatter f√ºr normale Gewinnberechnung
        if (lineSymbols[0] === "SCATTER") continue;
        
        // Pr√ºfe auf Gewinn (3+ gleiche Symbole)
        let matchCount = 1;
        let firstSymbol = lineSymbols[0];
        
        for (let i = 1; i < lineSymbols.length; i++) {
          if (lineSymbols[i] === firstSymbol) {
            matchCount++;
          } else {
            break;
          }
        }
        
        if (matchCount >= 3) {
          // Multiplikator finden
          const symbol = CONFIG.symbols.find(s => s.id === firstSymbol);
          if (symbol && symbol.multiplier) {
            const winMultiplier = symbol.multiplier[matchCount];
            if (winMultiplier) {
              const lineWin = State.currentBet * winMultiplier;
              totalWin += lineWin;
              
              winningLines.push({
                lineIndex,
                symbol: firstSymbol,
                matchCount,
                winAmount: lineWin,
                positions: payline.map((row, col) => ({ row, col }))
              });
            }
          }
        }
      }
      
      return {
        amount: totalWin,
        winningLines
      };
    }

    // Scatter pr√ºfen
    function checkScatter() {
      const cells = Array.from(elements.reels.querySelectorAll('.symbol-cell'));
      const scatterCells = cells.filter(cell => cell.dataset.symbol === "SCATTER");
      const scatterCount = scatterCells.length;
      
      return {
        scatterCount,
        scatterCells: scatterCells.map(cell => ({
          row: parseInt(cell.dataset.row),
          col: parseInt(cell.dataset.col)
        }))
      };
    }

    // Gewinnende Symbole hervorheben
    function highlightWinningSymbols(winningLines) {
      // Entferne alte Highlights
      elements.reels.querySelectorAll('.symbol-win').forEach(cell => {
        cell.classList.remove('symbol-win');
      });
      
      // Neue Highlights hinzuf√ºgen
      winningLines.forEach(line => {
        line.positions.forEach((pos, index) => {
          if (index < line.matchCount) {
            const cell = elements.reels.querySelector(
              `[data-row="${pos.row}"][data-col="${pos.col}"]`
            );
            if (cell) {
              cell.classList.add('symbol-win');
            }
          }
        });
      });
      
      // Win-Line anzeigen
      if (winningLines.length > 0) {
        elements.winLine.style.opacity = '1';
        setTimeout(() => {
          elements.winLine.style.opacity = '0';
        }, 2000);
      }
    }

    // Win-Highlights entfernen
    function clearWinHighlights() {
      elements.reels.querySelectorAll('.symbol-win').forEach(cell => {
        cell.classList.remove('symbol-win');
      });
      elements.winLine.style.opacity = '0';
    }

    // Nachricht anzeigen
    function showMessage(text, type = 'info') {
      if (!elements.message) return;
      
      elements.message.textContent = text;
      elements.message.className = 'messages';
      
      switch (type) {
        case 'win':
          elements.message.classList.add('win-message');
          break;
        case 'free-spins':
          elements.message.classList.add('free-spins-message');
          break;
        case 'error':
          elements.message.style.color = '#ff4444';
          break;
        case 'info':
          elements.message.style.color = '#f4d35e';
          break;
      }
    }

    // Sound abspielen
    function playSound(type) {
      if (!State.soundEnabled) return;
      
      // Einfache Sound-Implementierung
      try {
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();
        
        switch (type) {
          case 'spin-start':
            // Spin Sound
            break;
          case 'win':
            // Gewinn Sound
            break;
          case 'big-win':
            // Gro√üer Gewinn Sound
            break;
          case 'click':
            // Klick Sound
            break;
          case 'chip':
            // Chip Sound
            break;
          case 'free-spins':
            // Freispiel Sound
            break;
        }
      } catch (e) {
        // Audio nicht verf√ºgbar
      }
    }

    // Sound umschalten
    function toggleSound() {
      State.soundEnabled = !State.soundEnabled;
      const icon = document.querySelector('#soundToggle i');
      
      if (State.soundEnabled) {
        icon.className = 'fas fa-volume-up';
        showMessage('Sound aktiviert', 'info');
      } else {
        icon.className = 'fas fa-volume-mute';
        showMessage('Sound deaktiviert', 'info');
      }
    }

    // Initialisierung starten
    window.addEventListener('DOMContentLoaded', init);
  </script>
</body>
</html>